<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store Ranging & Deals App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .active-store { background-color: #2563eb; color: white; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .deal-button.selected { background-color: #16a34a; color: white; font-weight: bold; }
        #product-info-tooltip { z-index: 50; }
        #store-list-dropdown { z-index: 40; }
        #reset-modal, #image-modal { z-index: 60; transition: opacity 0.3s ease; backdrop-filter: blur(4px); }
        #reset-modal.hidden, #image-modal.hidden { opacity: 0; pointer-events: none; }
        #reset-modal .modal-content, #image-modal .modal-content { transform: scale(0.95); transition: transform 0.3s ease; }
        #reset-modal.show .modal-content, #image-modal.show .modal-content { transform: scale(1); }
        .view-toggle-btn.active { background-color: #3b82f6; color: white; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="h-screen flex flex-col">
        <main class="w-full flex-grow flex flex-col bg-slate-50">
            <header class="p-4 border-b border-slate-200 bg-white relative">
                <div id="store-selector-button" class="inline-block cursor-pointer p-2 -m-2 rounded-md hover:bg-slate-100">
                     <h2 id="results-header" class="text-xl font-bold text-slate-900">Product Dashboard</h2>
                     <p id="results-subheader" class="text-sm text-slate-500">Tap to select a specific store</p>
                </div>
                <div class="absolute top-4 right-4 space-x-2 flex items-center">
                    <button id="dashboard-btn" class="px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm">Dashboard üìä</button>
                    <div id="view-toggle-group" class="bg-slate-200 p-1 rounded-md flex space-x-1">
                        <button id="view-not-ranging-btn" class="view-toggle-btn active px-2 py-1 text-xs rounded-md">Not Ranging</button>
                        <button id="view-ranging-btn" class="view-toggle-btn px-2 py-1 text-xs rounded-md">Ranging</button>
                        <button id="view-not-buying-btn" class="view-toggle-btn px-2 py-1 text-xs rounded-md">Not Buying</button>
                    </div>
                    <button id="refresh-btn" class="px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm">Refresh üîÑ</button>
                    <button id="reset-btn" class="hidden px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 text-sm">Reset Offer ‚ùå</button>
                </div>
                <div id="store-list-dropdown" class="hidden absolute top-full left-4 mt-1 w-80 max-h-96 overflow-y-auto bg-white rounded-lg shadow-xl border border-slate-200 flex flex-col">
                    <div id="store-loader" class="text-center p-8">
                        <div class="loader mx-auto"></div>
                        <p class="mt-2 text-slate-500">Loading stores...</p>
                    </div>
                    <div class="p-2 border-b border-slate-200 sticky top-0 bg-white">
                        <input type="text" id="store-search-input" placeholder="Type to search stores..." class="w-full px-2 py-1 border border-slate-300 rounded-md">
                    </div>
                    <ul id="store-ul-list" class="flex-grow overflow-y-auto"></ul>
                </div>
            </header>

            <div class="flex-grow p-4 overflow-y-auto">
                <div id="main-content-area">
                    <!-- Dashboard View -->
                    <div id="dashboard-view">
                        <div id="dashboard-loader" class="text-center p-8 flex flex-col items-center justify-center">
                            <div class="loader mx-auto"></div>
                            <p class="mt-2 text-slate-500">Loading data...</p>
                        </div>
                        <div id="dashboard-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                            <!-- Product cards will be inserted here -->
                        </div>
                    </div>

                    <!-- Store View -->
                    <div id="store-view" class="hidden">
                        <div id="deal-offer-box" class="mb-4 p-4 bg-blue-100 border border-blue-200 rounded-lg hidden">
                            <h3 class="font-bold text-lg text-blue-800">Total Deal Offer Summary</h3>
                            <p class="text-sm text-blue-600">Based on 50% Deal Price</p>
                            <p id="deal-total" class="text-3xl font-bold text-blue-900 mt-1">$0.00</p>
                            <ul id="deal-list" class="mt-2 text-sm list-disc list-inside text-slate-700 space-y-1"></ul>
                        </div>
                         <div id="results-table-container" class="w-full">
                            <table class="min-w-full bg-white rounded-lg shadow">
                                <thead class="bg-slate-200">
                                    <tr id="table-header-row"></tr>
                                </thead>
                                <tbody id="results-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="product-info-tooltip" class="hidden fixed p-4 bg-white rounded-lg shadow-2xl border border-slate-300 max-w-xs w-full">
        <div class="flex justify-between items-center pb-2 border-b border-slate-200 mb-2">
            <h4 id="tooltip-product-name" class="font-bold text-base text-slate-800">Product Details</h4>
            <button id="tooltip-close-btn" class="text-2xl font-bold text-slate-400 hover:text-slate-800 leading-none">&times;</button>
        </div>
        <div id="tooltip-content" class="space-y-2 text-sm"></div>
    </div>

    <!-- Image Preview Modal -->
    <div id="image-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center">
      <div class="modal-content relative">
        <img id="image-modal-img" src="" alt="Preview" class="max-w-[90vw] max-h-[90vh] rounded-lg shadow-2xl">
        <button id="image-modal-close" class="absolute -top-4 -right-4 bg-white rounded-full p-2 shadow hover:bg-gray-200 text-2xl leading-none">‚úï</button>
      </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div id="reset-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
      <div class="modal-content bg-white rounded-lg shadow-xl p-6 max-w-sm w-full">
        <h3 class="text-lg font-bold text-slate-800 mb-2">Confirm Reset</h3>
        <p class="text-slate-600 mb-4">Are you sure you want to clear the saved deals for this store?</p>
        <div class="flex justify-end space-x-2">
          <button id="cancel-reset" class="px-4 py-2 bg-slate-300 rounded-md hover:bg-slate-400">Cancel</button>
          <button id="confirm-reset" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Reset Offer</button>
        </div>
      </div>
    </div>

    <script>
        // The complete JavaScript for your app is here
    </script>
</body>
</html>

