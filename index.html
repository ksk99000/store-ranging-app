<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“± Store Ranging App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .header { font-size: 22px; font-weight: bold; color: #0073e6; }
    .version { font-size: 12px; color: gray; }
    select, button { padding: 6px; margin: 5px 0; }
    #debug { font-size: 12px; background: #f9f9f9; border: 1px solid #ddd; padding: 10px; white-space: pre-wrap; }
    .error { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <div class="header">ðŸ“± Store Ranging App <span class="version">v2.4.3 (17 Sept 2025)</span></div>
  
  <button id="refresh">ðŸ”„ Refresh</button>
  <select id="storeDropdown"><option>-- Select a store --</option></select>

  <h3>Products</h3>
  <div id="products"></div>

  <h3>ðŸ›  Debug Output</h3>
  <div id="debug"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbziovfnY9nAhZ6-hy6NVa3QTxdM3IpSDjEH7is2Dvfjw7Mne4p2_F-nlItY2dDu3Lt5/exec";

    async function loadData() {
      const debug = document.getElementById("debug");
      debug.textContent = "Loading data...";
      try {
        const response = await fetch(API_URL);
        const json = await response.json();
        console.log("Fetched JSON:", json);
        debug.textContent = JSON.stringify(json, null, 2);

        // âœ… Handle both "Data" and "data"
        const rows = json.Data || json.data;
        if (!rows || rows.length < 2) {
          throw new Error("No Data sheet found or it has no rows.");
        }

        const header = rows[0];  // First row = column names
        const storeIndex = header.indexOf("Store"); // Find column B ("Store")

        if (storeIndex === -1) {
          throw new Error("Could not find 'Store' column in Data sheet.");
        }

        // Populate dropdown
        const dropdown = document.getElementById("storeDropdown");
        dropdown.innerHTML = "<option>-- Select a store --</option>";
        rows.slice(1).forEach(r => {
          if (r[storeIndex]) {
            let option = document.createElement("option");
            option.value = r[storeIndex];
            option.textContent = r[storeIndex];
            dropdown.appendChild(option);
          }
        });
      } catch (err) {
        debug.innerHTML = `<span class="error">Fetch error:</span> ${err.message}`;
      }
    }

    document.getElementById("refresh").addEventListener("click", loadData);
    window.onload = loadData;
  </script>
</body>
</html>