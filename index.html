<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Store Ranging App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background: #f9fbfd;
      color: #333;
    }
    header {
      background: #007aff;
      color: white;
      padding: 12px;
      font-size: 18px;
      font-weight: bold;
    }
    .controls {
      display: flex;
      gap: 10px;
      padding: 10px;
    }
    button {
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }
    .refresh { background: #007aff; color: white; }
    .offer { background: #007aff; color: white; }
    .offer.added { background: #28a745; }
    .notbuying { background: #dc3545; color: white; }
    .summary {
      background: #eef6ff;
      margin: 10px;
      padding: 10px;
      border-radius: 6px;
    }
    .product-card {
      display: flex;
      align-items: center;
      background: white;
      margin: 10px;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .product-card img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      margin-right: 12px;
    }
    .product-info {
      flex-grow: 1;
    }
    .debug {
      margin: 10px;
      padding: 10px;
      background: #fffbe6;
      border: 1px solid #ffe58f;
      border-radius: 6px;
      font-size: 13px;
      color: #555;
    }
  </style>
</head>
<body>
  <header>ðŸ“± Store Ranging App</header>
  <div class="controls">
    <button class="refresh" onclick="loadData()">Refresh</button>
  </div>

  <div class="summary" id="dealSummary">
    <strong>Total Deal Offer Summary</strong>
    <p id="totalOffer">$0.00</p>
  </div>

  <div id="products"></div>

  <div class="debug">
    <strong>ðŸ›  Debug Output</strong>
    <pre id="debug"></pre>
  </div>

  <script>
    const scriptUrl = "YOUR_SCRIPT_URL_HERE"; // replace with your Google Apps Script URL
    let productsData = [];
    let selectedOffers = {};

    async function loadData() {
      try {
        const res = await fetch(scriptUrl);
        const data = await res.json();
        productsData = data;
        renderProducts();
        document.getElementById("debug").textContent =
          "Loaded " + data.length + " products.";
      } catch (err) {
        document.getElementById("debug").textContent =
          "Error loading: " + err;
      }
    }

    function renderProducts() {
      const container = document.getElementById("products");
      container.innerHTML = "";
      productsData.forEach(p => {
        const card = document.createElement("div");
        card.className = "product-card";
        card.innerHTML = `
          <img src="${p['Image URL'] || ''}" alt="Product">
          <div class="product-info">
            <strong>${p['Product'] || 'Unnamed'}</strong>
            <p>50% Deal: ${p['50% Deal'] || '-'}</p>
          </div>
          <button class="offer ${selectedOffers[p['Product']] ? 'added' : ''}"
            onclick="toggleOffer('${p['Product']}', '${p['50% Deal'] || 0}', this)">
            ${selectedOffers[p['Product']] ? 'Added' : 'Add to Offer'}
          </button>
          <button class="notbuying" onclick="removeProduct('${p['Product']}')">Not Buying</button>
        `;
        container.appendChild(card);
      });
      updateSummary();
    }

    function toggleOffer(product, deal, btn) {
      const value = parseFloat((deal || "0").replace(/[^0-9.]/g, "")) || 0;
      if (selectedOffers[product]) {
        delete selectedOffers[product];
        btn.classList.remove("added");
        btn.textContent = "Add to Offer";
      } else {
        selectedOffers[product] = value;
        btn.classList.add("added");
        btn.textContent = "Added";
      }
      updateSummary();
    }

    function removeProduct(product) {
      productsData = productsData.filter(p => p['Product'] !== product);
      renderProducts();
    }

    function updateSummary() {
      const total = Object.values(selectedOffers).reduce((a, b) => a + b, 0);
      document.getElementById("totalOffer").textContent =
        "$" + total.toFixed(2);
    }

    loadData();
  </script>
</body>
</html>